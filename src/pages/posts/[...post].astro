---
import Layout from "../../layouts/Post.astro";
import { type CollectionEntry, getCollection } from "astro:content";
import filterOutDraftsIfProduction from "../../utils/filterOutDraftsIfProduction";
import labelDrafts from "../../utils/labelDrafts";
import sortByDate from "../../utils/sortByDate";
import toWithNextAndPrev, { type WithNextAndPrev } from "../../utils/toWithNextAndPrev";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return toWithNextAndPrev(labelDrafts(sortByDate(filterOutDraftsIfProduction(posts))), true).map((entry) => ({
    params: { post: entry.item.slug },
    props: { entry },
  }));
}

export type Props = {
  entry: WithNextAndPrev<CollectionEntry<"posts">>;
};
const { entry } = Astro.props;
const { Content } = await entry.item.render();
---

<Layout post={entry}>
  <Content />
</Layout>

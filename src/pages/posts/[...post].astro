---
import Layout from "../../layouts/Post.astro";
import { type CollectionEntry, getCollection } from "astro:content";
import {
  filterOutDraftsIfProduction,
  getCategory,
  sortByDate,
  toWithNextAndPrev,
type WithNextAndPrev,
} from "../../utils/utils";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return toWithNextAndPrev(sortByDate(filterOutDraftsIfProduction(posts))).map((entry) => ({
    params: { post: entry.item.slug },
    props: { entry },
  }));
}

export type Props = {
  entry: WithNextAndPrev<CollectionEntry<"posts">>;
};
const { entry } = Astro.props;
const { Content } = await entry.item.render();
const category = await getCategory(entry.item);
---

<Layout post={entry} category={category}>
  <Content />
</Layout>

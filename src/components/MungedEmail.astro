---
export type Props = {
    label: string;
    class?: string;
    subject?: string;
};

const { class: className, label, subject, ...rest } = Astro.props;

const queryParams = subject && (new URLSearchParams({
    subject: subject
})).toString();
---

<a
    class={className + " contact-email"}
    target="_blank"
    data-munged-user="pbagnpg"
    data-munged-domain="glyrezrepre.arg"
    data-query={queryParams}
    data-label={label}
    {...rest}
>
    [Enable JS to view email link]
</a>
<script>
    var links: NodeListOf<HTMLAnchorElement> = document.querySelectorAll(
        ".contact-email[data-munged-user]",
    )!;
    function dec(str: string) {
        return str.replace(/[a-zA-Z]/g, function (c: any) {
            return String.fromCharCode(
                (c <= "Z" ? 90 : 122) >= (c = c.charCodeAt(0) + 13)
                    ? c
                    : c - 26,
            );
        });
    }
    links.forEach((link) => {
        link.innerText = link.dataset.label || "send me an email";
        link.href = dec(
            `znvygb:${link.dataset.mungedUser}@${link.dataset.mungedDomain}`,
        ) + (link.dataset.query ? `?${link.dataset.query}` : '');
        link.removeAttribute("data-munged-user");
        link.removeAttribute("data-munged-domain");
        link.removeAttribute("data-label");
        link.removeAttribute("data-query");
    });
</script>

---
import Layout from '../../layouts/Post.astro';
import { type CollectionEntry, getCollection } from "astro:content";
import { filterOutDraftsIfProduction, getCategory } from '../../utils/utils';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return filterOutDraftsIfProduction(posts).map(entry => ({
    params: { post: entry.slug }, props: { entry },
  }));
}

export type Props = {
    entry: CollectionEntry<'posts'>;
}
const { entry } = Astro.props;
const { Content } = await entry.render();
const category = await getCategory(entry);
---
<Layout post={entry} category={category}>
    <Content />
</Layout>